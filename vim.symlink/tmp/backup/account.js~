/* global dependencies */
var $ = require('jquery');
var Backbone = require('backbone');
var AppChannel = require('advisor/app-channel');

var FacebookAccount = Backbone.Model.extend({
    url: function() {
        return '/api/facebook/ads/v1/adaccountadmin/';
    },
    initialize: function(attr) {
        if (attr && attr.agency) {
            this.set({'label': attr.agency.name + ' (' + attr.name + ')'});
        }
    }
});
var FacebookAccountCollection = Backbone.Collection.extend({
    model: FacebookAccount,
    url: function() {
        return '/api/facebook/ads/v1/adaccountadmin/' + $.fn.generateQueryString(this.filters);
    },
    initialize: function(options) {
        this.filters = options.query;
    },
    parse: function(data) {
        this.meta = data.meta;
        return data.objects;
    }
});
var getFacebookAccountEntities = function(options) {
    var facebookAccountCollection = new FacebookAccountCollection(options);
    var defer                     = $.Deferred();
    facebookAccountCollection.fetch({
        success: function(collection) { //collection, response, options
            defer.resolve(collection);
        },
        error: function(collection, response) { //collection, response, options
            console.log(response);
            defer.reject(response);
        }
    });
    return defer.promise();
};

AppChannel.reply('facebook:account:entities', function(options) {
    return getFacebookAccountEntities(options);
});
