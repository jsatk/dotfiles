/* global dependecies */
var Backbone = require('backbone');
var AppChannel = require('advisor/app-channel');
var $ = require('jquery');

/* local dependecies */
var InsertionView = require('../../insertion/cards/views/item-layout-view');
var CreateInsertionView = require('./new-view');

module.exports.loadCardView = function(options) {
    var campaign = options.campaign;

    /** If we have an insertion order display it, otherwise show the IO selection form. */
    if (campaign.get('insertion_order')) {
        displayIO();
    } else {
        createIO();
    }

    function displayIO() {
        // TODO: Back-end should return the insertion order's ID on the campaign.  Until it does this is the solution.
        var insertionOrderID = Number(
            campaign.get('insertion_order').match(/(\d+)\D*$/).pop()
        );

        $.when(
            AppChannel.request('advisor:insertionorder:entity', insertionOrderID)
        ).done(function(model) {
            var insertionView = new InsertionView({
                model: model,
                showBrand: false
            });

            options.region.show(insertionView);
        });
    }

    function createIO() {
        debugger;
        var createInsertionView = new CreateInsertionView({
            initiative: this.options.initiative,
            model: campaign
        });

        options.region.show(createInsertionView);
    }
};
