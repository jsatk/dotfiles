var targetEnv = process.env.AV_ENV || 'alpha';

module.exports = function(grunt, tasks) {

    /**
     * Runs the local node server.
     * uses the AV_ENV environment variable to determine which server to point at.
     * @returns Grunt tasks to be ran.
     */
    return function(target) {

        // TODO: remove this once docs and workflow is migrated from `grunt serve:alpha` to `AV_ENV=alpha grunt serve` syntax
        if (targetEnv) target = targetEnv

        var targetHosts = {
            alpha: 'alpha.socialcodedev.com',
            beta: 'beta.socialcode.com',
            prod: 'app.socialcode.com',
            staging: 'staging.socialcodedev.com'
        };

        grunt.config('connect.server.proxies', [
            {
                changeOrigin: true,
                context: ['/api', '/advisor', '/reports', '/accounts', '/static', '/custom-audience'],
                host: targetHosts[target],
                https: true,
                port: 443,
                xforward: false
            }
        ]);

        var tasksToRun = ['processhtml:local', 'configureProxies:server', 'connect:server', 'open', 'watch'];

        return grunt.task.run(tasks.concat(tasksToRun));
    };
};
