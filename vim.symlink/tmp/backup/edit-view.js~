AdvisorApp.module('CampaignModule.Edit', function(Edit, App) {

    var EditLayoutView = Marionette.LayoutView.extend({
        className: 'initiative-edit-sc',
        template: Handlebars.templates.campaignEditLayout,
        regions: {
            'tracking': '#tracking',
            'targeting': '#targeting',
            'sub-1': '#sub-1'
        },
        initialize: function(options) {
            this.templateHelpers = {
                platform: this.options.campaign.get('platform')
            };
        }
    });

    var EditSummaryView = Marionette.ItemView.extend({
        className: 'initiative-edit-summary-sc',
        template: Handlebars.templates.campaignEditSummary,
        ui: {
            'cardsSummaryContainer': '#campaign-card-summaries',
            'saveButton': '#save-campaign',
            'dontSave': '#cancel-edit'
        },
        events: {
            'click @ui.saveButton': function() {
                AdvisorApp.module('CampaignModule').moduleChannel.vent.trigger('edit:campaign:save', this.model);
            },
            'click @ui.dontSave': function(e) {
                e.preventDefault();
                AdvisorApp.module('CampaignModule').moduleChannel.vent.trigger('campaign:show', this.model.get('initiative_id'), this.model.get('id'));
            }
        },
        bindings: {
            '.view_tags': {
                observe: 'view_tags',
                onGet:   'expectNumber'
            },
            '.pixels': {
                observe: 'pixels',
                onGet:   'expectNumber'
            },
            '.genders': {
                observe: 'demographic_constraint',
                onGet:   function(value) {
                    var genders = value.gender;
                    return genders ? 1 : 0;
                }
            },
            '.age_ranges': {
                observe: 'demographic_constraint',
                onGet: function(values) {
                    var age_range = values.age_ranges[0];
                    return (age_range.min_age || age_range.max_age) ? 1 : 0;
                }
            },
            '.geo_locations': {
                observe: 'demographic_constraint',
                onGet:   function(values) {
                    return this.expectNumber(values.location_sets[0].locations);
                }
            }
        },
        onShow: function() {
            /** Add stickit */
            this.stickit();
        },
        expectNumber: function(value) {
            return value.length || 0;
        }
    });

    App.module('CampaignModule').on('start', function() {
        var moduleChannel = this.moduleChannel;

        moduleChannel.reqres.setHandler('edit:layout:View', function() {
            return EditLayoutView;
        });
        moduleChannel.reqres.setHandler('edit:summary:View', function() {
            return EditSummaryView;
        });
    });

});
